do local _ENV=_ENV or _G;local a=_ENV.getmetatable;local b=_ENV.setmetatable;local c=_ENV.tonumber;local d=_ENV.error;local e=_ENV.ipairs;local f=_ENV.next;local g=_ENV.type;local h=table.insert;local i=table.remove;local j=tfm.exec.addImage;local k=tfm.exec.removeImage;local l=ui.addTextArea;local m=ui.removeTextArea;local n=ui.updateTextArea;local function o(p,...)for q,r in e{...}do if g(r)=='table'then for s,t in f,r do p[s]=t end end end;return p end;local function u(v,w)for q,x in e(w)do if v==x then return q end end end;local function y()return{meta={}}end;local function z(A)return b({},A.meta)end;local function B(A,C)local D=a(A)or{}D.__call=C;b(A,D)end;local function E(A,F)A.meta.__index=F end;local function G(A,v)return a(v)==A.meta end;local H,I;local J;local K;local L;local M;local N;local O;local P=0;function J(Q,p)Q=K(Q)Q.target=p;return Q end;function K(Q)local R=o({},Q)local S=Q.children;if g(S)=='table'then local T={}for q,U in e(S)do local V=K(U)T[q]=V;V.parent=R end;R.children=T end;R.origin=Q;return b(R,a(Q))end;function L(Q)while true do local F=Q.parent;if not F then return Q end;Q=F end end;function M(Q,W,X,Y)if Q.display==false and not Q._removed then return Q end;local p=O or L(Q).target;if G(H,Q)then local Z=not N;N=N or 1;if Q._removed then k(Q._id)return true end;Q._id=j(Q.id,'&'..N,Q.x,Q.y,p)if Z then N=nil elseif N<9 then N=N+1 end elseif G(I,Q)then Y=Q._removed or Y;if Y then m(Q._id,p)local _=Q._border;if _ then for a0 in f,_ do m(a0,p)end;Q._border=nil end else local a1=c(Q.x)or 0;local a2=c(Q.y)or 0;local a3=c(Q.width)or 0;local a4=c(Q.height)or 0;a3=a3<10 and 10 or a3;a4=a4<10 and 10 or a4;local a5=Q.alpha;local a6=Q.fixed;if Q.inherit~=false then a5=a5 or X;a6=a6 or W end;X,W=a5,a6;W=W==nil or W;local a7=c(Q.background)or 0x324650;local _=Q.border;a1=a1-a3/2;a2=a2-a4/2;if g(_)=='table'then a1=a1+2;a2=a2+2;a3=a3-4;a4=a4-4;local a8={}local a9=_[1]or 0;if a9>0 then local aa=a9<3;local ab,ac;if aa then ab=a9==2 and 1 or 2;ac=ab*2;a9=3;a1=a1+ab;a2=a2+ab;a3=a3-ac;a4=a4-ac end;local ad,ae,af,ag;if#_==3 then ad=c(_[2])or 1;ad=ad<1 and 1 or ad;af=c(_[3])or ad;af=af<1 and 1 or af;ae=ad;ag=af else ad=c(_[2])or 1;ad=ad<1 and 1 or ad;ae=c(_[3])or ad;ae=ae<1 and 1 or ae;af=c(_[4])or ae;af=af<1 and 1 or af;ag=c(_[5])or ae;ag=ag<1 and 1 or ag end;local ah={ad,ae,af,ag}for q=1,4 do local ai=ah[q]local aj,ak,al,am;if q%2==1 then al=a9;am=a4+a9*2;aj=q==1 and a1-al or a1+a3;ak=a2-a9 else al=a3+a9*2;am=a9;aj=a1-a9;ak=q==2 and a2-am or a2+a4 end;l(P,'',p,aj,ak,al,am,ai,ai,X,W)a8[P]=true;P=P+1 end;if aa then a1=a1-ab;a2=a2-ab;a3=a3+ac;a4=a4+ac end end;_=a7;Q._border=a8 else _=c(_)or 1 end;local a0=Q._id;if not a0 then a0=P;Q._id=a0;P=P+1 end;l(a0,Q.html or'',p,a1,a2,a3,a4,a7,_,X,W)end;local S=Q.children;if g(S)=='table'then local an=not O;O=p;local ao={}local ap=0;for q,U in e(S)do local aq=c(U.z)or#ao+1;aq=aq>ap and 1 or aq;h(ao,aq,U)ap=ap+1 end;for q,U in e(ao)do M(U,W,X,Y)end;if an then O=nil end end end;return Q end;local function ar(as)if not G(I,as)then return false end;local at=not O;O=O or L(as).target;n(as._id,as.html or'',O)local S=as.children;if S then for q,U in e(S)do ar(U)end end;return true end;local function au(Q)Q._removed=true;return Q end;local av={'id','x','y'}H=y()B(H,function(H,...)local self=z(H)for q,aw in e{...}do local ax=av[q]if not ax or g(aw)=='table'then o(self,aw)else self[ax]=aw end end;return self end)E(H,{build=J,clone=K,remove=au,top=L,update=M})local av={'x','y','width','height'}I=y()B(I,function(I,...)local self=z(I)for q,aw in e{...}do local ax=av[q]if not ax or g(aw)=='table'then o(self,aw)else self[ax]=aw end end;return self end)local function ay(Q,az)local S=Q.children;if S then for q,U in e(Q.children)do if U.origin==az then return U end;local aA=ay(U,az)if aA then return aA end end end end;E(I,{addChild=function(self,...)local S=self.children or{}self.children=S;for q,aB in e{...}do S[#S+1]=aB end;return self end,build=J,clone=K,findCloneOf=ay,remove=au,removeChild=function(self,...)local S=self.children;if S then for aC,p in e{...}do local q=u(p,S)if q then i(p,q)end end;if#S==0 then self.children=nil end end;return self end,top=L,update=M,updateHTML=ar})txshop={Image=H,TextArea=I}end
