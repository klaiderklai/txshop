do local _ENV=_ENV or _G;local a=_ENV.getmetatable;local b=_ENV.setmetatable;local c=_ENV.tonumber;local d=_ENV.error;local e=_ENV.ipairs;local f=_ENV.next;local g=_ENV.type;local h=table.insert;local i=table.remove;local j=tfm.exec.addImage;local k=tfm.exec.removeImage;local l=ui.addTextArea;local m=ui.removeTextArea;local n=ui.updateTextArea;local function o(target,...)for p,q in e{...}do if g(q)=='table'then for r,s in f,q do target[r]=s end end end;return target end;local function t(u,v)for p,w in e(v)do if u==w then return p end end end;local function x()return{meta={}}end;local function y(z)return b({},z.meta)end;local function A(z,B)local C=a(z)or{}C.__call=B;b(z,C)end;local function D(z,E)z.meta.__index=E end;local function F(z,u)return a(u)==z.meta end;local G,H;local I;local J;local K;local L;local M;local N;local O;local P;local Q;local R;local S=0;function I(obj,target)obj=J(obj)obj.target=target;return obj end;function J(obj)local T=o({},obj)local U=obj.children;if g(U)=='table'then local V={}for p,W in e(U)do local X=J(W)V[p]=X;X.parent=T end;T.children=V end;T.origin=obj;return b(T,a(obj))end;function K(obj)while true do local E=obj.parent;if not E then return obj end;obj=E end end;local function Y(Z,_,a0,a1,a2,a3,alpha,fixed,a4)l(id,obj.html or'',target,Z,_,a0,a1,a2,border,alpha,fixed)end;function L(obj)if obj.display==false and not obj._removed then return obj end;local target=O or K(obj).target;if F(G,obj)then local a5=not M;M=M or 1;if obj._removed then k(obj._id)return obj end;obj._id=j(obj.id,'&'..M,obj.x,obj.y,target)if a5 then M=nil elseif M<9 then M=M+1 end elseif F(H,obj)then local a6=not N;local a7=obj._removed or R;if a7 then m(obj._id,target)local border=obj._border;if border then for id in f,border do m(id,target)end;obj._border=nil end else local Z=c(obj.x)or 0;local _=c(obj.y)or 0;local a0=c(obj.width)or 0;local a1=c(obj.height)or 0;a0=a0<10 and 10 or a0;a1=a1<10 and 10 or a1;local alpha=obj.alpha;local fixed=obj.fixed;if N and obj.inherit~=false then alpha=alpha or P;fixed=fixed or Q end;fixed=fixed==nil or fixed;local a2=c(obj.background)or 0x324650;local border=obj.border;Z=Z-a0/2;_=_-a1/2;if g(border)=='table'then Z=Z+2;_=_+2;a0=a0-4;a1=a1-4;local a8={}local a9=border[1]or 0;if a9>0 then local aa=a9<3;local ab,ac;if aa then ab=a9==2 and 1 or 2;ac=ab*2;a9=3;Z=Z+ab;_=_+ab;a0=a0-ac;a1=a1-ac end;local ad,ae,af,ag;if#border==3 then ad=c(border[2])or 1;ad=ad<1 and 1 or ad;af=c(border[3])or ad;af=af<1 and 1 or af;ae=ad;ag=af else ad=c(border[2])or 1;ad=ad<1 and 1 or ad;ae=c(border[3])or ad;ae=ae<1 and 1 or ae;af=c(border[4])or ae;af=af<1 and 1 or af;ag=c(border[5])or ae;ag=ag<1 and 1 or ag end;local ah={ad,ae,af,ag}for p=1,4 do local a3=ah[p]local ai,aj,ak,al;if p%2==1 then ak=a9;al=a1+a9*2;ai=p==1 and Z-ak or Z+a0;aj=_-a9 else ak=a0+a9*2;al=a9;ai=Z-a9;aj=p==2 and _-al or _+a1 end;l(S,'',target,ai,aj,ak,al,a3,a3,alpha,fixed)a8[S]=true;S=S+1 end;if aa then Z=Z-ab;_=_-ab;a0=a0+ac;a1=a1+ac end end;border=a2;obj._border=a8 else border=c(border)or 1 end;local id=obj._id;if not id then id=S;obj._id=id;S=S+1 end;l(id,obj.html or'',target,Z,_,a0,a1,a2,border,alpha,fixed)end;N=obj;P=alpha;Q=fixed;R=a7;local U=obj.children;if g(U)=='table'then local am=not O;O=target;local an={}local ao=0;for p,W in e(U)do ao=ao+1;local ap=c(W.z)or ao;ap=ap>ao and ao or ap<1 and 1 or ap;h(an,ap,W)end;for p,W in e(an)do L(W,fixed,alpha,a7)end;if am then O=nil end end;if a6 then N=nil;P=nil;Q=nil;R=nil end end;return obj end;local function aq(ar)if not F(H,ar)then return ar end;local as=not O;O=O or K(ar).target;n(ar._id,ar.html or'',O)local U=ar.children;if U then for p,W in e(U)do aq(W)end end;return ar end;local function at(obj)obj._removed=true;return obj end;local au={'id','x','y'}G=x()A(G,function(G,...)local self=y(G)for p,av in e{...}do local aw=au[p]if not aw or g(av)=='table'then o(self,av)else self[aw]=av end end;return self end)D(G,{build=I,clone=J,remove=at,top=K,update=L})local au={'x','y','width','height'}H=x()A(H,function(H,...)local self=y(H)for p,av in e{...}do local aw=au[p]if not aw or g(av)=='table'then o(self,av)else self[aw]=av end end;return self end)local function ax(obj,ay)local U=obj.children;if U then for p,W in e(obj.children)do if W.origin==ay then return W end;local az=ax(W,ay)if az then return az end end end end;local function aA(obj,...)local U=obj.children;if U then for aB,target in e{...}do for p,W in e(U)do if W==target then i(target,p)break else aA(W,target)end end end;if#U==0 then obj.children=nil end end;return obj end;D(H,{addChild=function(self,...)local U=self.children or{}self.children=U;for p,aC in e{...}do U[#U+1]=aC end;return self end,build=I,clone=J,findCloneOf=ax,remove=at,removeChild=aA,top=K,update=L,updateHTML=aq})txshop={Image=G,TextArea=H}end
